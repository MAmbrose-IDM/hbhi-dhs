key_list[[1]]$v001<-NGAshplist[[1]]@data[,"DHSCLUST"] #1993
key_list[[2]]$v001<-NGAshplist[[2]]@data[,"DHSCLUST"] #2003
key_list[[3]]$v001<-NGAshplist[[3]]@data[,"DHSCLUST"] #2008
key_list[[4]]$v001<-NGAshplist[[4]]@data[,"DHSCLUST"] #2010
key_list[[5]]$v001<-NGAshplist[[5]]@data[,"DHSCLUST"] #2013
key_list[[6]]$v001<-NGAshplist[[6]]@data[,"DHSCLUST"] #2015
key_list[[7]]$v001<-NGAshplist[[7]]@data[,"DHSCLUST"] #2018
PR.list <- list(NGAfiles[[6]], NGAfiles[[9]], NGAfiles[[12]], NGAfiles[[15]], NGAfiles[[18]], NGAfiles[[21]])
PR.list <- lapply(PR.list, subset, hv103 == "1")
PR.list <- map(PR.list, recode_itn)
PR.list <- map(PR.list, survey.month.fun)
# key list for ITN (2003, 2008, 2010, 2013, 2015, 2017/2018)
keys.hh.itn <- list(key_list[[2]], key_list[[3]], key_list[[4]], key_list[[5]],key_list[[6]], key_list[[7]])
#changing to a list of keys
# key datasets and dhs/mis datasets are joined
hh.itn.list <- map2(PR.list, keys.hh.itn, left_join) #PR datasets
rep_DS.ls <- list(rep_DS)
hh.itn.list <- map2(hh.itn.list, rep_DS.ls, left_join) #PR datasets
hh.itn.list  <- lapply(hh.itn.list, subset, hv105 >= 10 & hv105 <= 18)
table(hh.itn.list[[1]]$hv105)
hh.itn.list[[4]] <-dataclean.HH(hh.itn.list[[4]], hml12, hv005,'hh_itn', 'hh_itn')
hh.itn.svyd13 <- svydesign.fun(hh.itn.list[[4]])
DS_hh_itn_13 <- result.fun('hh_itn', 'State + hv025','num_p', design=hh.itn.svyd13)
head(DS_hh_itn_13)
DS_hh_itn_13 <- result.fun('hh_itn', 'LGA','num_p', design=hh.itn.svyd13)
head(DS_hh_itn_13)
DS_hh_itn_13 <- rep_DS %>% left_join(DS_hh_itn_13)
head(DS_hh_itn_13)
summary(DS_hh_itn_13$hh_itn)
rep_DS_hh_itn_13 <- result.fun('hh_itn', 'repDS','num_p', design=hh.itn.svyd13)
head(rep_DS_hh_itn_13)
rep_DS_hh_itn_13 <- rep_DS_hh_itn_13 %>% dplyr::select(repDS, hh_itn_repDS = hh_itn,
se_repDS = se, Num_repDS = `Number of Participants`)
head(rep_DS_hh_itn_13)
rep_DS_hh_itn_13 <- DS_hh_itn_13 %>% left_join(rep_DS_hh_itn_13) %>%
mutate(hh_itn = ifelse(hh_itn =="0"| hh_itn == "1" |is.na(hh_itn),
hh_itn_repDS, hh_itn),
ci_l = hh_itn - (1.96 * se_repDS), ci_u = hh_itn + (1.96 * se_repDS)) %>%
mutate(ci_l = ifelse(ci_l < 0, 0, ci_l))
head(rep_DS_hh_itn_13)
write.csv(rep_DS_hh_itn_13, "results/archetype_sim_input/Intervention_files_LGA/ITN/ten_eighteen2013repDS_LGA_v2.csv")
# creating list of files with PR data for 2003, 2008, 2010, 2013, 2015, 2017/2018
PR.list <- list(NGAfiles[[6]], NGAfiles[[9]], NGAfiles[[12]], NGAfiles[[15]], NGAfiles[[18]], NGAfiles[[21]])
PR.list <- lapply(PR.list, subset, hv103 == "1")
PR.list <- map(PR.list, recode_itn)
PR.list <- map(PR.list, survey.month.fun)
# key list for ITN (2003, 2008, 2010, 2013, 2015, 2017/2018)
keys.hh.itn <- list(key_list[[2]], key_list[[3]], key_list[[4]], key_list[[5]],key_list[[6]], key_list[[7]])
#changing to a list of keys
# key datasets and dhs/mis datasets are joined
hh.itn.list <- map2(PR.list, keys.hh.itn, left_join) #PR datasets
rep_DS.ls <- list(rep_DS)
hh.itn.list <- map2(hh.itn.list, rep_DS.ls, left_join) #PR datasets
hh.itn.list  <- lapply(hh.itn.list, subset, hv105 >= 6 & hv105 <= 9)
table(hh.itn.list[[1]]$hv105)
hh.itn.list[[4]] <-dataclean.HH(hh.itn.list[[4]], hml12, hv005,'hh_itn', 'hh_itn')
hh.itn.svyd13 <- svydesign.fun(hh.itn.list[[4]])
DS_hh_itn_13 <- result.fun('hh_itn', 'LGA','num_p', design=hh.itn.svyd13)
head(DS_hh_itn_13)
# DS_hh_itn_13_v2 <- DS_hh_itn_13 %>%
#   dplyr::select(State, hv025, hh_itn) %>%
#   pivot_wider(names_from = hv025, values_from = hh_itn)
# head(DS_hh_itn_13_v2)
#
# write.csv(DS_hh_itn_13_v2, "results/urbanvsrural/2013_ITNstate.csv")
#next join each LGA to their repDS
DS_hh_itn_13 <- rep_DS %>% left_join(DS_hh_itn_13)
head(DS_hh_itn_13)
summary(DS_hh_itn_13$hh_itn)
#repDS_level estimates and change variable names
rep_DS_hh_itn_13 <- result.fun('hh_itn', 'repDS','num_p', design=hh.itn.svyd13)
head(rep_DS_hh_itn_13)
rep_DS_hh_itn_13 <- rep_DS_hh_itn_13 %>% dplyr::select(repDS, hh_itn_repDS = hh_itn,
se_repDS = se, Num_repDS = `Number of Participants`)
head(rep_DS_hh_itn_13)
#Now combine LGA files with LGA level estimates with repDS estimates
rep_DS_hh_itn_13 <- DS_hh_itn_13 %>% left_join(rep_DS_hh_itn_13) %>%
mutate(hh_itn = ifelse(hh_itn =="0"| hh_itn == "1" |is.na(hh_itn),
hh_itn_repDS, hh_itn),
ci_l = hh_itn - (1.96 * se_repDS), ci_u = hh_itn + (1.96 * se_repDS)) %>%
mutate(ci_l = ifelse(ci_l < 0, 0, ci_l))
head(rep_DS_hh_itn_13)
write.csv(rep_DS_hh_itn_13, "results/archetype_sim_input/Intervention_files_LGA/ITN/six_nine2013repDS_LGA_v2.csv")
PR.list <- list(NGAfiles[[6]], NGAfiles[[9]], NGAfiles[[12]], NGAfiles[[15]], NGAfiles[[18]], NGAfiles[[21]])
PR.list <- lapply(PR.list, subset, hv103 == "1")
PR.list <- map(PR.list, recode_itn)
PR.list <- map(PR.list, survey.month.fun)
# key list for ITN (2003, 2008, 2010, 2013, 2015, 2017/2018)
keys.hh.itn <- list(key_list[[2]], key_list[[3]], key_list[[4]], key_list[[5]],key_list[[6]], key_list[[7]])
#changing to a list of keys
# key datasets and dhs/mis datasets are joined
hh.itn.list <- map2(PR.list, keys.hh.itn, left_join) #PR datasets
rep_DS.ls <- list(rep_DS)
hh.itn.list <- map2(hh.itn.list, rep_DS.ls, left_join) #PR datasets
hh.itn.list  <- lapply(hh.itn.list, subset, hv105 <= 5)
table(hh.itn.list[[1]]$hv105)
hh.itn.list[[4]] <-dataclean.HH(hh.itn.list[[4]], hml12, hv005,'hh_itn', 'hh_itn')
hh.itn.svyd13 <- svydesign.fun(hh.itn.list[[4]])
DS_hh_itn_13 <- result.fun('hh_itn', 'LGA','num_p', design=hh.itn.svyd13)
head(DS_hh_itn_13)
# DS_hh_itn_13_v2 <- DS_hh_itn_13 %>%
#   dplyr::select(State, hv025, hh_itn) %>%
#   pivot_wider(names_from = hv025, values_from = hh_itn)
# head(DS_hh_itn_13_v2)
#
# write.csv(DS_hh_itn_13_v2, "results/urbanvsrural/2013_ITNstate.csv")
#next join each LGA to their repDS
DS_hh_itn_13 <- rep_DS %>% left_join(DS_hh_itn_13)
head(DS_hh_itn_13)
summary(DS_hh_itn_13$hh_itn)
#repDS_level estimates and change variable names
rep_DS_hh_itn_13 <- result.fun('hh_itn', 'repDS','num_p', design=hh.itn.svyd13)
head(rep_DS_hh_itn_13)
rep_DS_hh_itn_13 <- rep_DS_hh_itn_13 %>% dplyr::select(repDS, hh_itn_repDS = hh_itn,
se_repDS = se, Num_repDS = `Number of Participants`)
head(rep_DS_hh_itn_13)
#Now combine LGA files with LGA level estimates with repDS estimates
rep_DS_hh_itn_13 <- DS_hh_itn_13 %>% left_join(rep_DS_hh_itn_13) %>%
mutate(hh_itn = ifelse(hh_itn =="0"| hh_itn == "1" |is.na(hh_itn),
hh_itn_repDS, hh_itn),
ci_l = hh_itn - (1.96 * se_repDS), ci_u = hh_itn + (1.96 * se_repDS)) %>%
mutate(ci_l = ifelse(ci_l < 0, 0, ci_l))
head(rep_DS_hh_itn_13)
write.csv(rep_DS_hh_itn_13, "results/archetype_sim_input/Intervention_files_LGA/ITN/U52013repDS_LGA_v2.csv")
hh.itn.list[[5]] <-dataclean.HH(hh.itn.list[[5]], hml12, hv005,'hh_itn', 'hh_itn')
hh.itn.svyd15 <- svydesign.fun(hh.itn.list[[5]])
DS_hh_itn_15 <- result.fun('hh_itn', 'LGA','num_p', design=hh.itn.svyd15)
head(DS_hh_itn_15)
# DS_hh_itn_15_v2 <- DS_hh_itn_15  %>%
#   dplyr::select(State, hv025, hh_itn) %>%
#   pivot_wider(names_from = hv025, values_from = hh_itn)
# head(DS_hh_itn_15_v2)
#
# write.csv(DS_hh_itn_15_v2, "results/urbanvsrural/2015_ITNstate.csv")
#next join each LGA to their repDS
DS_hh_itn_15 <- rep_DS %>% left_join(DS_hh_itn_15)
head(DS_hh_itn_15)
summary(DS_hh_itn_15$hh_itn)
#repDS_level estimates and change variable names
rep_DS_hh_itn_15 <- result.fun('hh_itn', 'repDS','num_p', design=hh.itn.svyd15)
head(rep_DS_hh_itn_15)
rep_DS_hh_itn_15 <- rep_DS_hh_itn_15  %>% dplyr::select(repDS, hh_itn_repDS = hh_itn,
ci_l_repDS = ci_l, ci_u_repDS = ci_u, Num_repDS = `Number of Participants`)
head(rep_DS_hh_itn_15)
#Now combine LGA files with LGA level estimates with repDS estimates
rep_DS_hh_itn_15 <- DS_hh_itn_15 %>% left_join(rep_DS_hh_itn_15) %>%
mutate(hh_itn = ifelse(hh_itn =="0"| hh_itn == "1" |is.na(hh_itn),
hh_itn_repDS, hh_itn))
head(rep_DS_hh_itn_15)
DS_hh_itn_15 <- result.fun('hh_itn', 'LGA','num_p', design=hh.itn.svyd15)
head(DS_hh_itn_15)
DS_hh_itn_15 <- rep_DS %>% left_join(DS_hh_itn_15)
head(DS_hh_itn_15)
summary(DS_hh_itn_15$hh_itn)
rep_DS_hh_itn_15 <- result.fun('hh_itn', 'repDS','num_p', design=hh.itn.svyd15)
head(rep_DS_hh_itn_15)
rep_DS_hh_itn_15 <- rep_DS_hh_itn_15  %>% dplyr::select(repDS, hh_itn_repDS = hh_itn,
se_repDS = se, Num_repDS = `Number of Participants`)
head(rep_DS_hh_itn_15)
rep_DS_hh_itn_15 <- DS_hh_itn_15 %>% left_join(rep_DS_hh_itn_15) %>%
mutate(hh_itn = ifelse(hh_itn =="0"| hh_itn == "1" |is.na(hh_itn),
hh_itn_repDS, hh_itn),
ci_l = hh_itn - (1.96 * se_repDS), ci_u = hh_itn + (1.96 * se_repDS)) %>%
mutate(ci_l = ifelse(ci_l < 0, 0, ci_l))
head(rep_DS_hh_itn_15)
write.csv(rep_DS_hh_itn_15, "results/archetype_sim_input/Intervention_files_LGA/ITN/U52015repDS_LGA.csv")
write.csv(rep_DS_hh_itn_15, "results/archetype_sim_input/Intervention_files_LGA/ITN/U52015repDS_LGA_v2.csv")
DS_hh_itn_15 <- result.fun('hh_itn', 'LGA','num_p', design=hh.itn.svyd15)
head(DS_hh_itn_15)
# DS_hh_itn_15_v2 <- DS_hh_itn_15  %>%
#   dplyr::select(State, hv025, hh_itn) %>%
#   pivot_wider(names_from = hv025, values_from = hh_itn)
# head(DS_hh_itn_15_v2)
#
# write.csv(DS_hh_itn_15_v2, "results/urbanvsrural/2015_ITNstate.csv")
#next join each LGA to their repDS
DS_hh_itn_15 <- rep_DS %>% left_join(DS_hh_itn_15)
head(DS_hh_itn_15)
summary(DS_hh_itn_15$hh_itn)
#repDS_level estimates and change variable names
rep_DS_hh_itn_15 <- result.fun('hh_itn', 'repDS','num_p', design=hh.itn.svyd15)
head(rep_DS_hh_itn_15)
rep_DS_hh_itn_15 <- rep_DS_hh_itn_15  %>% dplyr::select(repDS, hh_itn_repDS = hh_itn,
se_repDS = se, Num_repDS = `Number of Participants`)
head(rep_DS_hh_itn_15)
#Now combine LGA files with LGA level estimates with repDS estimates
rep_DS_hh_itn_15 <- DS_hh_itn_15 %>% left_join(rep_DS_hh_itn_15) %>%
mutate(hh_itn = ifelse(hh_itn =="0"| hh_itn == "1" |is.na(hh_itn),
hh_itn_repDS, hh_itn),
ci_l = hh_itn - (1.96 * se_repDS), ci_u = hh_itn + (1.96 * se_repDS)) %>%
mutate(ci_l = ifelse(ci_l < 0, 0, ci_l), ci_u > 1, 1, ci_u)
head(rep_DS_hh_itn_15)
write.csv(rep_DS_hh_itn_15, "results/archetype_sim_input/Intervention_files_LGA/ITN/U52015repDS_LGA_v2.csv")
DS_hh_itn_15 <- result.fun('hh_itn', 'LGA','num_p', design=hh.itn.svyd15)
head(DS_hh_itn_15)
# DS_hh_itn_15_v2 <- DS_hh_itn_15  %>%
#   dplyr::select(State, hv025, hh_itn) %>%
#   pivot_wider(names_from = hv025, values_from = hh_itn)
# head(DS_hh_itn_15_v2)
#
# write.csv(DS_hh_itn_15_v2, "results/urbanvsrural/2015_ITNstate.csv")
#next join each LGA to their repDS
DS_hh_itn_15 <- rep_DS %>% left_join(DS_hh_itn_15)
head(DS_hh_itn_15)
summary(DS_hh_itn_15$hh_itn)
#repDS_level estimates and change variable names
rep_DS_hh_itn_15 <- result.fun('hh_itn', 'repDS','num_p', design=hh.itn.svyd15)
head(rep_DS_hh_itn_15)
rep_DS_hh_itn_15 <- rep_DS_hh_itn_15  %>% dplyr::select(repDS, hh_itn_repDS = hh_itn,
se_repDS = se, Num_repDS = `Number of Participants`)
head(rep_DS_hh_itn_15)
#Now combine LGA files with LGA level estimates with repDS estimates
rep_DS_hh_itn_15 <- DS_hh_itn_15 %>% left_join(rep_DS_hh_itn_15) %>%
mutate(hh_itn = ifelse(hh_itn =="0"| hh_itn == "1" |is.na(hh_itn),
hh_itn_repDS, hh_itn),
ci_l = hh_itn - (1.96 * se_repDS), ci_u = hh_itn + (1.96 * se_repDS)) %>%
mutate(ci_l = ifelse(ci_l < 0, 0, ci_l), ci_u =ifelse(ci_u > 1, 1, ci_u))
head(rep_DS_hh_itn_15)
write.csv(rep_DS_hh_itn_15, "results/archetype_sim_input/Intervention_files_LGA/ITN/U52015repDS_LGA_v2.csv")
PR.list <- list(NGAfiles[[6]], NGAfiles[[9]], NGAfiles[[12]], NGAfiles[[15]], NGAfiles[[18]], NGAfiles[[21]])
PR.list <- lapply(PR.list, subset, hv103 == "1")
PR.list <- map(PR.list, recode_itn)
PR.list <- map(PR.list, survey.month.fun)
# key list for ITN (2003, 2008, 2010, 2013, 2015, 2017/2018)
keys.hh.itn <- list(key_list[[2]], key_list[[3]], key_list[[4]], key_list[[5]],key_list[[6]], key_list[[7]])
#changing to a list of keys
# key datasets and dhs/mis datasets are joined
hh.itn.list <- map2(PR.list, keys.hh.itn, left_join) #PR datasets
rep_DS.ls <- list(rep_DS)
hh.itn.list <- map2(hh.itn.list, rep_DS.ls, left_join) #PR datasets
hh.itn.list  <- lapply(hh.itn.list, subset, hv105 >= 6 & <= 9 )
table(hh.itn.list[[1]]$hv105)
hh.itn.list  <- lapply(hh.itn.list, subset, hv105 >= 6 & hv015 <= 9)
table(hh.itn.list[[1]]$hv105)
PR.list <- list(NGAfiles[[6]], NGAfiles[[9]], NGAfiles[[12]], NGAfiles[[15]], NGAfiles[[18]], NGAfiles[[21]])
PR.list <- lapply(PR.list, subset, hv103 == "1")
PR.list <- map(PR.list, recode_itn)
PR.list <- map(PR.list, survey.month.fun)
# key list for ITN (2003, 2008, 2010, 2013, 2015, 2017/2018)
keys.hh.itn <- list(key_list[[2]], key_list[[3]], key_list[[4]], key_list[[5]],key_list[[6]], key_list[[7]])
#changing to a list of keys
# key datasets and dhs/mis datasets are joined
hh.itn.list <- map2(PR.list, keys.hh.itn, left_join) #PR datasets
rep_DS.ls <- list(rep_DS)
hh.itn.list <- map2(hh.itn.list, rep_DS.ls, left_join) #PR datasets
hh.itn.list  <- lapply(hh.itn.list, subset, hv105 >= 6 & hv015 <= 9)
table(hh.itn.list[[1]]$hv105)
hh.itn.list  <- lapply(hh.itn.list, subset, hv105 >= 6 & hv105 <= 9)
table(hh.itn.list[[1]]$hv105)
hh.itn.list[[5]] <-dataclean.HH(hh.itn.list[[5]], hml12, hv005,'hh_itn', 'hh_itn')
hh.itn.svyd15 <- svydesign.fun(hh.itn.list[[5]])
DS_hh_itn_15 <- result.fun('hh_itn', 'LGA','num_p', design=hh.itn.svyd15)
head(DS_hh_itn_15)
DS_hh_itn_15 <- rep_DS %>% left_join(DS_hh_itn_15)
head(DS_hh_itn_15)
summary(DS_hh_itn_15$hh_itn)
rep_DS_hh_itn_15 <- result.fun('hh_itn', 'repDS','num_p', design=hh.itn.svyd15)
head(rep_DS_hh_itn_15)
rep_DS_hh_itn_15 <- rep_DS_hh_itn_15  %>% dplyr::select(repDS, hh_itn_repDS = hh_itn,
se_repDS = se, Num_repDS = `Number of Participants`)
head(rep_DS_hh_itn_15)
rep_DS_hh_itn_15 <- DS_hh_itn_15 %>% left_join(rep_DS_hh_itn_15) %>%
mutate(hh_itn = ifelse(hh_itn =="0"| hh_itn == "1" |is.na(hh_itn),
hh_itn_repDS, hh_itn),
ci_l = hh_itn - (1.96 * se_repDS), ci_u = hh_itn + (1.96 * se_repDS)) %>%
mutate(ci_l = ifelse(ci_l < 0, 0, ci_l), ci_u =ifelse(ci_u > 1, 1, ci_u))
head(rep_DS_hh_itn_15)
write.csv(rep_DS_hh_itn_15, "results/archetype_sim_input/Intervention_files_LGA/ITN/six_nine2015repDS_LGA_v2.csv")
# creating list of files with PR data for 2003, 2008, 2010, 2013, 2015, 2017/2018
PR.list <- list(NGAfiles[[6]], NGAfiles[[9]], NGAfiles[[12]], NGAfiles[[15]], NGAfiles[[18]], NGAfiles[[21]])
PR.list <- lapply(PR.list, subset, hv103 == "1")
PR.list <- map(PR.list, recode_itn)
PR.list <- map(PR.list, survey.month.fun)
# key list for ITN (2003, 2008, 2010, 2013, 2015, 2017/2018)
keys.hh.itn <- list(key_list[[2]], key_list[[3]], key_list[[4]], key_list[[5]],key_list[[6]], key_list[[7]])
#changing to a list of keys
# key datasets and dhs/mis datasets are joined
hh.itn.list <- map2(PR.list, keys.hh.itn, left_join) #PR datasets
rep_DS.ls <- list(rep_DS)
hh.itn.list <- map2(hh.itn.list, rep_DS.ls, left_join) #PR datasets
hh.itn.list  <- lapply(hh.itn.list, subset, hv105 >= 10 & hv105 <= 18)
table(hh.itn.list[[1]]$hv105)
hh.itn.list[[5]] <-dataclean.HH(hh.itn.list[[5]], hml12, hv005,'hh_itn', 'hh_itn')
hh.itn.svyd15 <- svydesign.fun(hh.itn.list[[5]])
DS_hh_itn_15 <- result.fun('hh_itn', 'LGA','num_p', design=hh.itn.svyd15)
head(DS_hh_itn_15)
# DS_hh_itn_15_v2 <- DS_hh_itn_15  %>%
#   dplyr::select(State, hv025, hh_itn) %>%
#   pivot_wider(names_from = hv025, values_from = hh_itn)
# head(DS_hh_itn_15_v2)
#
# write.csv(DS_hh_itn_15_v2, "results/urbanvsrural/2015_ITNstate.csv")
#next join each LGA to their repDS
DS_hh_itn_15 <- rep_DS %>% left_join(DS_hh_itn_15)
head(DS_hh_itn_15)
summary(DS_hh_itn_15$hh_itn)
#repDS_level estimates and change variable names
rep_DS_hh_itn_15 <- result.fun('hh_itn', 'repDS','num_p', design=hh.itn.svyd15)
head(rep_DS_hh_itn_15)
rep_DS_hh_itn_15 <- rep_DS_hh_itn_15  %>% dplyr::select(repDS, hh_itn_repDS = hh_itn,
se_repDS = se, Num_repDS = `Number of Participants`)
head(rep_DS_hh_itn_15)
#Now combine LGA files with LGA level estimates with repDS estimates
rep_DS_hh_itn_15 <- DS_hh_itn_15 %>% left_join(rep_DS_hh_itn_15) %>%
mutate(hh_itn = ifelse(hh_itn =="0"| hh_itn == "1" |is.na(hh_itn),
hh_itn_repDS, hh_itn),
ci_l = hh_itn - (1.96 * se_repDS), ci_u = hh_itn + (1.96 * se_repDS)) %>%
mutate(ci_l = ifelse(ci_l < 0, 0, ci_l), ci_u =ifelse(ci_u > 1, 1, ci_u))
head(rep_DS_hh_itn_15)
write.csv(rep_DS_hh_itn_15, "results/archetype_sim_input/Intervention_files_LGA/ITN/ten_eighteen2015repDS_LGA_v2.csv")
PR.list <- list(NGAfiles[[6]], NGAfiles[[9]], NGAfiles[[12]], NGAfiles[[15]], NGAfiles[[18]], NGAfiles[[21]])
PR.list <- lapply(PR.list, subset, hv103 == "1")
PR.list <- map(PR.list, recode_itn)
PR.list <- map(PR.list, survey.month.fun)
# key list for ITN (2003, 2008, 2010, 2013, 2015, 2017/2018)
keys.hh.itn <- list(key_list[[2]], key_list[[3]], key_list[[4]], key_list[[5]],key_list[[6]], key_list[[7]])
#changing to a list of keys
# key datasets and dhs/mis datasets are joined
hh.itn.list <- map2(PR.list, keys.hh.itn, left_join) #PR datasets
rep_DS.ls <- list(rep_DS)
hh.itn.list <- map2(hh.itn.list, rep_DS.ls, left_join) #PR datasets
hh.itn.list  <- lapply(hh.itn.list, subset, hv105 > 18)
table(hh.itn.list[[1]]$hv105)
hh.itn.list[[5]] <-dataclean.HH(hh.itn.list[[5]], hml12, hv005,'hh_itn', 'hh_itn')
hh.itn.svyd15 <- svydesign.fun(hh.itn.list[[5]])
DS_hh_itn_15 <- result.fun('hh_itn', 'LGA','num_p', design=hh.itn.svyd15)
head(DS_hh_itn_15)
# DS_hh_itn_15_v2 <- DS_hh_itn_15  %>%
#   dplyr::select(State, hv025, hh_itn) %>%
#   pivot_wider(names_from = hv025, values_from = hh_itn)
# head(DS_hh_itn_15_v2)
#
# write.csv(DS_hh_itn_15_v2, "results/urbanvsrural/2015_ITNstate.csv")
#next join each LGA to their repDS
DS_hh_itn_15 <- rep_DS %>% left_join(DS_hh_itn_15)
head(DS_hh_itn_15)
summary(DS_hh_itn_15$hh_itn)
#repDS_level estimates and change variable names
rep_DS_hh_itn_15 <- result.fun('hh_itn', 'repDS','num_p', design=hh.itn.svyd15)
head(rep_DS_hh_itn_15)
rep_DS_hh_itn_15 <- rep_DS_hh_itn_15  %>% dplyr::select(repDS, hh_itn_repDS = hh_itn,
se_repDS = se, Num_repDS = `Number of Participants`)
head(rep_DS_hh_itn_15)
#Now combine LGA files with LGA level estimates with repDS estimates
rep_DS_hh_itn_15 <- DS_hh_itn_15 %>% left_join(rep_DS_hh_itn_15) %>%
mutate(hh_itn = ifelse(hh_itn =="0"| hh_itn == "1" |is.na(hh_itn),
hh_itn_repDS, hh_itn),
ci_l = hh_itn - (1.96 * se_repDS), ci_u = hh_itn + (1.96 * se_repDS)) %>%
mutate(ci_l = ifelse(ci_l < 0, 0, ci_l), ci_u =ifelse(ci_u > 1, 1, ci_u))
head(rep_DS_hh_itn_15)
write.csv(rep_DS_hh_itn_15, "results/archetype_sim_input/Intervention_files_LGA/ITN/over_eighteen2015repDS_LGA_v2.csv")
hh.itn.list[[6]] <-dataclean.HH(hh.itn.list[[6]], hml12, hv005,'hh_itn', 'hh_itn')
hh.itn.svyd18 <- svydesign.fun(hh.itn.list[[6]])
#LGA_level estimates
DS_hh_itn_18 <- result.fun('hh_itn', 'LGA','num_p', design=hh.itn.svyd18)
head(DS_hh_itn_18)
DS_hh_itn_18 <- rep_DS %>% left_join(DS_hh_itn_18)
head(DS_hh_itn_18)
summary(DS_hh_itn_18$hh_itn)
rep_DS_hh_itn_18 <- result.fun('hh_itn', 'repDS','num_p', design=hh.itn.svyd18)
head(rep_DS_hh_itn_18)
rep_DS_hh_itn_18 <- rep_DS_hh_itn_18  %>% dplyr::select(repDS, hh_itn_repDS = hh_itn,
se_repDS = se,Num_repDS = `Number of Participants`)
head(rep_DS_hh_itn_18)
rep_DS_hh_itn_18 <- DS_hh_itn_18 %>% left_join(rep_DS_hh_itn_18) %>%
mutate(hh_itn = ifelse(hh_itn =="0"| hh_itn == "1" |is.na(hh_itn),
hh_itn_repDS, hh_itn),
ci_l = hh_itn - (1.96 * se_repDS), ci_u = hh_itn + (1.96 * se_repDS)) %>%
mutate(ci_l = ifelse(ci_l < 0, 0, ci_l), ci_u =ifelse(ci_u > 1, 1, ci_u))
head(rep_DS_hh_itn_18)
write.csv(rep_DS_hh_itn_18 , "results/archetype_sim_input/Intervention_files_LGA/ITN/over_eighteen2018repDS_LGA_v2.csv")
PR.list <- list(NGAfiles[[6]], NGAfiles[[9]], NGAfiles[[12]], NGAfiles[[15]], NGAfiles[[18]], NGAfiles[[21]])
PR.list <- lapply(PR.list, subset, hv103 == "1")
PR.list <- map(PR.list, recode_itn)
PR.list <- map(PR.list, survey.month.fun)
# key list for ITN (2003, 2008, 2010, 2013, 2015, 2017/2018)
keys.hh.itn <- list(key_list[[2]], key_list[[3]], key_list[[4]], key_list[[5]],key_list[[6]], key_list[[7]])
#changing to a list of keys
# key datasets and dhs/mis datasets are joined
hh.itn.list <- map2(PR.list, keys.hh.itn, left_join) #PR datasets
rep_DS.ls <- list(rep_DS)
hh.itn.list <- map2(hh.itn.list, rep_DS.ls, left_join) #PR datasets
hh.itn.list  <- lapply(hh.itn.list, subset, hv105 >=10 & hv105 <=18)
table(hh.itn.list[[1]]$hv105)
hh.itn.list[[6]] <-dataclean.HH(hh.itn.list[[6]], hml12, hv005,'hh_itn', 'hh_itn')
hh.itn.svyd18 <- svydesign.fun(hh.itn.list[[6]])
#LGA_level estimates
DS_hh_itn_18 <- result.fun('hh_itn', 'LGA','num_p', design=hh.itn.svyd18)
head(DS_hh_itn_18)
# DS_hh_itn_18_v2 <- DS_hh_itn_18  %>%
#   dplyr::select(State, hv025, hh_itn) %>%
#   pivot_wider(names_from = hv025, values_from = hh_itn)
# head(DS_hh_itn_18_v2)
#
# write.csv(DS_hh_itn_18_v2, "results/urbanvsrural/2018_ITNstate.csv")
#next join each LGA to their repDS
DS_hh_itn_18 <- rep_DS %>% left_join(DS_hh_itn_18)
head(DS_hh_itn_18)
summary(DS_hh_itn_18$hh_itn)
#repDS_level estimates and change variable names
rep_DS_hh_itn_18 <- result.fun('hh_itn', 'repDS','num_p', design=hh.itn.svyd18)
head(rep_DS_hh_itn_18)
rep_DS_hh_itn_18 <- rep_DS_hh_itn_18  %>% dplyr::select(repDS, hh_itn_repDS = hh_itn,
se_repDS = se,Num_repDS = `Number of Participants`)
head(rep_DS_hh_itn_18)
#Now combine LGA files with LGA level estimates with repDS estimates
rep_DS_hh_itn_18 <- DS_hh_itn_18 %>% left_join(rep_DS_hh_itn_18) %>%
mutate(hh_itn = ifelse(hh_itn =="0"| hh_itn == "1" |is.na(hh_itn),
hh_itn_repDS, hh_itn),
ci_l = hh_itn - (1.96 * se_repDS), ci_u = hh_itn + (1.96 * se_repDS)) %>%
mutate(ci_l = ifelse(ci_l < 0, 0, ci_l), ci_u =ifelse(ci_u > 1, 1, ci_u))
head(rep_DS_hh_itn_18)
write.csv(rep_DS_hh_itn_18 , "results/archetype_sim_input/Intervention_files_LGA/ITN/ten_eighteen2018repDS_LGA_v2.csv")
# creating list of files with PR data for 2003, 2008, 2010, 2013, 2015, 2017/2018
PR.list <- list(NGAfiles[[6]], NGAfiles[[9]], NGAfiles[[12]], NGAfiles[[15]], NGAfiles[[18]], NGAfiles[[21]])
PR.list <- lapply(PR.list, subset, hv103 == "1")
PR.list <- map(PR.list, recode_itn)
PR.list <- map(PR.list, survey.month.fun)
# key list for ITN (2003, 2008, 2010, 2013, 2015, 2017/2018)
keys.hh.itn <- list(key_list[[2]], key_list[[3]], key_list[[4]], key_list[[5]],key_list[[6]], key_list[[7]])
#changing to a list of keys
# key datasets and dhs/mis datasets are joined
hh.itn.list <- map2(PR.list, keys.hh.itn, left_join) #PR datasets
rep_DS.ls <- list(rep_DS)
hh.itn.list <- map2(hh.itn.list, rep_DS.ls, left_join) #PR datasets
hh.itn.list  <- lapply(hh.itn.list, subset, hv105 >=6 & hv105 <=9)
table(hh.itn.list[[1]]$hv105)
hh.itn.list[[6]] <-dataclean.HH(hh.itn.list[[6]], hml12, hv005,'hh_itn', 'hh_itn')
hh.itn.svyd18 <- svydesign.fun(hh.itn.list[[6]])
#LGA_level estimates
DS_hh_itn_18 <- result.fun('hh_itn', 'LGA','num_p', design=hh.itn.svyd18)
head(DS_hh_itn_18)
# DS_hh_itn_18_v2 <- DS_hh_itn_18  %>%
#   dplyr::select(State, hv025, hh_itn) %>%
#   pivot_wider(names_from = hv025, values_from = hh_itn)
# head(DS_hh_itn_18_v2)
#
# write.csv(DS_hh_itn_18_v2, "results/urbanvsrural/2018_ITNstate.csv")
#next join each LGA to their repDS
DS_hh_itn_18 <- rep_DS %>% left_join(DS_hh_itn_18)
head(DS_hh_itn_18)
summary(DS_hh_itn_18$hh_itn)
#repDS_level estimates and change variable names
rep_DS_hh_itn_18 <- result.fun('hh_itn', 'repDS','num_p', design=hh.itn.svyd18)
head(rep_DS_hh_itn_18)
rep_DS_hh_itn_18 <- rep_DS_hh_itn_18  %>% dplyr::select(repDS, hh_itn_repDS = hh_itn,
se_repDS = se,Num_repDS = `Number of Participants`)
head(rep_DS_hh_itn_18)
#Now combine LGA files with LGA level estimates with repDS estimates
rep_DS_hh_itn_18 <- DS_hh_itn_18 %>% left_join(rep_DS_hh_itn_18) %>%
mutate(hh_itn = ifelse(hh_itn =="0"| hh_itn == "1" |is.na(hh_itn),
hh_itn_repDS, hh_itn),
ci_l = hh_itn - (1.96 * se_repDS), ci_u = hh_itn + (1.96 * se_repDS)) %>%
mutate(ci_l = ifelse(ci_l < 0, 0, ci_l), ci_u =ifelse(ci_u > 1, 1, ci_u))
head(rep_DS_hh_itn_18)
write.csv(rep_DS_hh_itn_18 , "results/archetype_sim_input/Intervention_files_LGA/ITN/six_nine2018repDS_LGA_v2.csv")
# creating list of files with PR data for 2003, 2008, 2010, 2013, 2015, 2017/2018
PR.list <- list(NGAfiles[[6]], NGAfiles[[9]], NGAfiles[[12]], NGAfiles[[15]], NGAfiles[[18]], NGAfiles[[21]])
PR.list <- lapply(PR.list, subset, hv103 == "1")
PR.list <- map(PR.list, recode_itn)
PR.list <- map(PR.list, survey.month.fun)
# key list for ITN (2003, 2008, 2010, 2013, 2015, 2017/2018)
keys.hh.itn <- list(key_list[[2]], key_list[[3]], key_list[[4]], key_list[[5]],key_list[[6]], key_list[[7]])
#changing to a list of keys
# key datasets and dhs/mis datasets are joined
hh.itn.list <- map2(PR.list, keys.hh.itn, left_join) #PR datasets
rep_DS.ls <- list(rep_DS)
hh.itn.list <- map2(hh.itn.list, rep_DS.ls, left_join) #PR datasets
hh.itn.list  <- lapply(hh.itn.list, subset, hv105 >=5)
table(hh.itn.list[[1]]$hv105)
PR.list <- list(NGAfiles[[6]], NGAfiles[[9]], NGAfiles[[12]], NGAfiles[[15]], NGAfiles[[18]], NGAfiles[[21]])
PR.list <- lapply(PR.list, subset, hv103 == "1")
PR.list <- map(PR.list, recode_itn)
PR.list <- map(PR.list, survey.month.fun)
# key list for ITN (2003, 2008, 2010, 2013, 2015, 2017/2018)
keys.hh.itn <- list(key_list[[2]], key_list[[3]], key_list[[4]], key_list[[5]],key_list[[6]], key_list[[7]])
#changing to a list of keys
# key datasets and dhs/mis datasets are joined
hh.itn.list <- map2(PR.list, keys.hh.itn, left_join) #PR datasets
rep_DS.ls <- list(rep_DS)
hh.itn.list <- map2(hh.itn.list, rep_DS.ls, left_join) #PR datasets
hh.itn.list  <- lapply(hh.itn.list, subset, hv105 <=5)
table(hh.itn.list[[1]]$hv105)
hh.itn.list[[6]] <-dataclean.HH(hh.itn.list[[6]], hml12, hv005,'hh_itn', 'hh_itn')
hh.itn.svyd18 <- svydesign.fun(hh.itn.list[[6]])
#LGA_level estimates
DS_hh_itn_18 <- result.fun('hh_itn', 'LGA','num_p', design=hh.itn.svyd18)
head(DS_hh_itn_18)
# DS_hh_itn_18_v2 <- DS_hh_itn_18  %>%
#   dplyr::select(State, hv025, hh_itn) %>%
#   pivot_wider(names_from = hv025, values_from = hh_itn)
# head(DS_hh_itn_18_v2)
#
# write.csv(DS_hh_itn_18_v2, "results/urbanvsrural/2018_ITNstate.csv")
#next join each LGA to their repDS
DS_hh_itn_18 <- rep_DS %>% left_join(DS_hh_itn_18)
head(DS_hh_itn_18)
summary(DS_hh_itn_18$hh_itn)
#repDS_level estimates and change variable names
rep_DS_hh_itn_18 <- result.fun('hh_itn', 'repDS','num_p', design=hh.itn.svyd18)
head(rep_DS_hh_itn_18)
rep_DS_hh_itn_18 <- rep_DS_hh_itn_18  %>% dplyr::select(repDS, hh_itn_repDS = hh_itn,
se_repDS = se,Num_repDS = `Number of Participants`)
head(rep_DS_hh_itn_18)
#Now combine LGA files with LGA level estimates with repDS estimates
rep_DS_hh_itn_18 <- DS_hh_itn_18 %>% left_join(rep_DS_hh_itn_18) %>%
mutate(hh_itn = ifelse(hh_itn =="0"| hh_itn == "1" |is.na(hh_itn),
hh_itn_repDS, hh_itn),
ci_l = hh_itn - (1.96 * se_repDS), ci_u = hh_itn + (1.96 * se_repDS)) %>%
mutate(ci_l = ifelse(ci_l < 0, 0, ci_l), ci_u =ifelse(ci_u > 1, 1, ci_u))
head(rep_DS_hh_itn_18)
write.csv(rep_DS_hh_itn_18 , "results/archetype_sim_input/Intervention_files_LGA/ITN/U52018repDS_LGA_v2.csv")
